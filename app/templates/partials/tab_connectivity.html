<!-- TAB CONEXI√ìN (PHASE V: TELEPHONY TOOLS) -->
<div x-show="activeTab === 'connectivity'" class="space-y-6 animate-fade-in-up">

    <!-- HEADER -->
    <div class="flex items-center space-x-2 mb-4">
        <div class="p-2 bg-emerald-500/10 rounded-lg">
            <svg class="w-6 h-6 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z">
                </path>
            </svg>
        </div>
        <div>
            <h3 class="text-lg font-bold text-white">Conectividad & Hardware</h3>
            <p class="text-xs text-slate-400">BYOC, SIP Trunking, Grabaci√≥n y Compliance (HIPAA).</p>
        </div>
    </div>

    <!-- PESTA√ëAS INTERNAS DE CONECTIVIDAD -->
    <div x-data="{ subTab: 'keys' }" class="bg-slate-900/50 border border-white/5 rounded-xl p-1">
        <div class="flex space-x-1 mb-4 p-1 bg-black/20 rounded-lg">
            <button @click="subTab = 'keys'"
                :class="{'bg-slate-700 text-white shadow': subTab === 'keys', 'text-slate-500 hover:text-slate-300': subTab !== 'keys'}"
                class="flex-1 py-1.5 text-xs font-bold rounded-md transition-all">
                üîë Credenciales (BYOC)
            </button>
            <button @click="subTab = 'sip'"
                :class="{'bg-slate-700 text-white shadow': subTab === 'sip', 'text-slate-500 hover:text-slate-300': subTab !== 'sip'}"
                class="flex-1 py-1.5 text-xs font-bold rounded-md transition-all">
                üì° SIP & Trunking
            </button>
            <button @click="subTab = 'features'"
                :class="{'bg-slate-700 text-white shadow': subTab === 'features', 'text-slate-500 hover:text-slate-300': subTab !== 'features'}"
                class="flex-1 py-1.5 text-xs font-bold rounded-md transition-all">
                ‚öôÔ∏è Opciones Llamada
            </button>
        </div>

        <!-- 1. KEYS (BYOC) -->
        <div x-show="subTab === 'keys'" class="space-y-4 px-3 pb-3">

            <!-- TWILIO SECTION -->
            <div class="glass-panel p-4 rounded-xl border border-red-500/20 relative overflow-hidden">
                <div class="absolute top-0 right-0 p-2 opacity-5">
                    <svg class="w-16 h-16 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                        <path
                            d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 22c-5.523 0-10-4.477-10-10S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10z" />
                    </svg>
                </div>
                <h4 class="text-sm font-bold text-red-400 mb-3 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-red-500"></span> Twilio (Phone)
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="md:col-span-2">
                        <label class="text-[10px] uppercase text-slate-500 font-bold block mb-1">Credentials</label>
                        <div class="flex items-center gap-2 px-3 py-2 bg-slate-900/50 rounded border border-white/5">
                            <span class="text-xs text-red-400 font-mono">üîí Credentials configured via
                                Environment</span>
                            <svg class="w-3 h-3 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="md:col-span-2">
                        <label class="text-[10px] uppercase text-slate-500 font-bold block mb-1">From Number (Caller
                            ID)</label>
                        <input type="text" x-model="c.twilioFromNumber" placeholder="+1234567890"
                            class="glass-input w-full p-2 text-xs font-mono">
                    </div>
                </div>
            </div>

            <!-- TELNYX SECTION -->
            <div class="glass-panel p-4 rounded-xl border border-emerald-500/20 relative overflow-hidden">
                <div class="absolute top-0 right-0 p-2 opacity-5">
                    <svg class="w-16 h-16 text-emerald-500" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2L1 21h22L12 2zm0 3.516L20.297 19H3.703L12 5.516z" />
                    </svg>
                </div>
                <h4 class="text-sm font-bold text-emerald-400 mb-3 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-emerald-500"></span> Telnyx
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="md:col-span-2">
                        <div class="md:col-span-2">
                            <label class="text-[10px] uppercase text-slate-500 font-bold block mb-1">Credentials</label>
                            <div
                                class="flex items-center gap-2 px-3 py-2 bg-slate-900/50 rounded border border-white/5">
                                <span class="text-xs text-emerald-400 font-mono">üîí API Key configured via
                                    Environment</span>
                                <svg class="w-3 h-3 text-emerald-500" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M5 13l4 4L19 7"></path>
                                </svg>
                            </div>
                        </div>
                        <div>
                            <label class="text-[10px] uppercase text-slate-500 font-bold block mb-1">SIP Connection
                                ID</label>
                            <input type="text" x-model="c.telnyxConnectionId" placeholder="Uuid"
                                class="glass-input w-full p-2 text-xs font-mono">
                        </div>
                        <div>
                            <label class="text-[10px] uppercase text-slate-500 font-bold block mb-1">Caller ID
                                (Override)</label>
                            <input type="text" x-model="c.callerIdTelnyx" placeholder="+1..."
                                class="glass-input w-full p-2 text-xs font-mono">
                        </div>
                    </div>
                </div>

                <!-- TEST CALL WIDGET -->
                <div class="md:col-span-2 mt-2 pt-2 border-t border-emerald-500/20">
                    <label class="text-[10px] uppercase text-emerald-500 font-bold block mb-1">üöë Test Driver (Real
                        Call)</label>
                    <div class="flex gap-2">
                        <input type="text" x-data="{ target: '' }" x-model="target" placeholder="To: +1..."
                            class="glass-input flex-1 p-2 text-xs font-mono bg-black/40">
                        <button @click="
                                if(!target) return alert('Enter number');
                                fetch('/api/v1/calls/test-outbound', {
                                    method: 'POST',
                                    headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer '+(new URLSearchParams(window.location.search).get('api_key') || '')},
                                    body: JSON.stringify({ to: target })
                                })
                                .then(r => r.json())
                                .then(d => {
                                    if(d.status==='success') alert('Calling... ID: ' + d.call_id);
                                    else alert('Error: ' + d.detail);
                                })
                                .catch(e => alert('Fail: '+e))
                            "
                            class="px-3 py-1 bg-emerald-600 hover:bg-emerald-500 text-white text-xs font-bold rounded shadow-lg transition-all flex items-center gap-1">
                            <span>üìû</span> Call
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. SIP & TRUNKING -->
        <div x-show="subTab === 'sip'" class="space-y-4 px-3 pb-3">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Phone SIP -->
                <div class="bg-slate-800/50 p-4 rounded-lg">
                    <h5 class="text-xs font-bold text-slate-300 mb-3">Twilio SIP Trunking</h5>
                    <div class="space-y-3">
                        <div>
                            <label class="text-[10px] text-slate-500 block">SIP Trunk URI</label>
                            <input type="text" x-model="c.sipTrunkUriPhone" placeholder="sip:..."
                                class="glass-input w-full p-2 text-xs">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <input type="text" x-model="c.sipAuthUserPhone" placeholder="User"
                                class="glass-input w-full p-2 text-xs">
                            <input type="password" x-model="c.sipAuthPassPhone" placeholder="Pass"
                                class="glass-input w-full p-2 text-xs">
                        </div>
                        <div>
                            <label class="text-[10px] text-slate-500 block">Geo-Region</label>
                            <select x-model="c.geoRegionPhone" class="glass-input w-full p-2 text-xs bg-slate-900">
                                <option value="us-east-1">US East (N. Virginia)</option>
                                <option value="us-west-1">US West (Oregon)</option>
                                <option value="eu-west-1">Europe (Ireland)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Telnyx SIP -->
                <div class="bg-slate-800/50 p-4 rounded-lg">
                    <h5 class="text-xs font-bold text-slate-300 mb-3">Telnyx SIP Trunking</h5>
                    <div class="space-y-3">
                        <div>
                            <label class="text-[10px] text-slate-500 block">SIP Trunk URI</label>
                            <input type="text" x-model="c.sipTrunkUriTelnyx" placeholder="sip:..."
                                class="glass-input w-full p-2 text-xs">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <input type="text" x-model="c.sipAuthUserTelnyx" placeholder="User"
                                class="glass-input w-full p-2 text-xs">
                            <input type="password" x-model="c.sipAuthPassTelnyx" placeholder="Pass"
                                class="glass-input w-full p-2 text-xs">
                        </div>
                        <div>
                            <label class="text-[10px] text-slate-500 block">Geo-Region</label>
                            <select x-model="c.geoRegionTelnyx" class="glass-input w-full p-2 text-xs bg-slate-900">
                                <option value="us-central">US Central (Chicago)</option>
                                <option value="us-east">US East (Ashburn)</option>
                                <option value="global">Global Anycast</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FALLBACK -->
            <div class="bg-indigo-900/20 p-3 rounded border border-indigo-500/20">
                <label class="text-xs font-bold text-indigo-300 block mb-1">Fallback Number (Desv√≠o de
                    Emergencia)</label>
                <div class="flex gap-2">
                    <input type="text" x-model="c.fallbackNumberPhone" placeholder="+1..."
                        class="glass-input flex-1 p-2 text-xs">
                    <span class="text-[10px] text-slate-500 self-center">Si falla el bot, desviar aqu√≠.</span>
                </div>
            </div>
        </div>

        <!-- 3. FEATURES & COMPLIANCE -->
        <div x-show="subTab === 'features'" class="space-y-4 px-3 pb-3">

            <!-- RECORDING -->
            <div class="glass-panel p-4 rounded-lg border border-white/5">
                <div class="flex justify-between items-center mb-3">
                    <h5 class="text-sm font-bold text-white flex items-center gap-2">
                        <svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z">
                            </path>
                        </svg>
                        Grabaci√≥n de Llamadas
                    </h5>
                </div>

                <!-- Twilio Rec -->
                <div class="flex justify-between items-center py-2 border-b border-white/5">
                    <div>
                        <span class="text-xs text-slate-300">Twilio Recording</span>
                        <div class="flex gap-2 mt-1">
                            <select x-model="c.recordingChannelsPhone"
                                class="bg-black/30 border border-white/10 rounded text-[10px] text-slate-400">
                                <option value="mono">Mono (Mixed)</option>
                                <option value="dual">Dual (Stereo)</option>
                            </select>
                        </div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" x-model="c.recordingEnabledPhone" class="sr-only peer">
                        <div
                            class="w-9 h-5 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-red-500">
                        </div>
                    </label>
                </div>

                <!-- Telnyx Rec -->
                <div class="flex justify-between items-center py-2">
                    <div>
                        <span class="text-xs text-slate-300">Telnyx Recording</span>
                        <div class="flex gap-2 mt-1">
                            <select x-model="c.recordingChannelsTelnyx"
                                class="bg-black/30 border border-white/10 rounded text-[10px] text-slate-400">
                                <option value="dual">Dual (Stereo)</option>
                                <option value="mono">Mono (Mixed)</option>
                            </select>
                        </div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" x-model="c.enableRecordingTelnyx" class="sr-only peer">
                        <div
                            class="w-9 h-5 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-emerald-500">
                        </div>
                    </label>
                </div>
            </div>

            <!-- COMPLIANCE & TRANSFER -->
            <!-- COMPLIANCE & TRANSFER -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Compliance -->
                <div class="bg-slate-800/50 p-4 rounded-lg border border-slate-700">
                    <h5 class="text-xs font-bold text-slate-300 mb-3">Compliance & Security</h5>

                    <!-- Twilio HIPAA -->
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs text-slate-400">HIPAA (Twilio)</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" x-model="c.hipaaEnabledPhone" class="sr-only peer">
                            <div
                                class="w-9 h-5 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-500">
                            </div>
                        </label>
                    </div>

                    <!-- Telnyx HIPAA -->
                    <div class="flex justify-between items-center mb-2 pt-2 border-t border-white/5">
                        <span class="text-xs text-slate-400">HIPAA (Telnyx)</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" x-model="c.hipaaEnabledTelnyx" class="sr-only peer">
                            <div
                                class="w-9 h-5 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-emerald-500">
                            </div>
                        </label>
                    </div>

                    <p class="text-[10px] text-slate-500 mt-2">Enforce encrypted storage & transport.</p>
                </div>

                <!-- Transfer / DTMF / AMD -->
                <div class="bg-slate-800/50 p-4 rounded-lg border border-slate-700">
                    <h5 class="text-xs font-bold text-slate-300 mb-3">Advanced Features</h5>

                    <div class="space-y-3">
                        <!-- Twilio DTMF -->
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-slate-400">DTMF Listening (Twilio)</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" x-model="c.dtmfListeningEnabledPhone" class="sr-only peer">
                                <div
                                    class="w-7 h-4 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:bg-indigo-500 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-3 after:w-3">
                                </div>
                            </label>
                        </div>

                        <!-- Telnyx DTMF -->
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-slate-400">DTMF Listening (Telnyx)</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" x-model="c.dtmfListeningEnabledTelnyx" class="sr-only peer">
                                <div
                                    class="w-7 h-4 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:bg-emerald-500 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-3 after:w-3">
                                </div>
                            </label>
                        </div>

                        <!-- Telnyx AMD -->
                        <div class="pt-2 border-t border-white/5">
                            <span class="text-xs text-slate-400 block mb-1">Telnyx Answer Machine (AMD)</span>
                            <select x-model="c.amdConfig"
                                class="bg-black/30 border border-white/10 rounded w-full p-1 text-[10px] text-slate-300">
                                <option value="disabled">Disabled</option>
                                <option value="detect">Detect Only</option>
                                <option value="detect_hangup">Detect & Hangup</option>
                                <option value="detect_message_end">Detect Message End</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>