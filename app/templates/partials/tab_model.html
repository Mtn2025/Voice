<!-- TAB START: MODEL -->
<div x-show="activeTab === 'model'" class="space-y-5 animate-fade-in-up">
    <div class="grid grid-cols-2 gap-4">
        <div>
            <label class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 block">Proveedor
                LLM</label>
            <div x-data="customSelect({
                value: c.provider,
                options: [{value:'groq', label:'Groq'}, {value:'azure', label:'Azure OpenAI'}]
            })" x-modelable="value" x-model="c.provider" @change="updateModelList()" class="relative z-[50]">
                <button type="button" @click="toggle()" @click.away="clickOutside()"
                    class="glass-input w-full p-2.5 rounded-lg text-sm flex justify-between items-center hover:bg-slate-800 transition-colors">
                    <span x-text="selectedLabel"></span>
                    <svg class="w-4 h-4 text-slate-500">
                        <use href="#icon-chevron-down"></use>
                    </svg>
                </button>
                <div x-show="open" x-transition.opacity
                    class="absolute top-full left-0 w-full mt-1 bg-[#1E293B] border border-slate-700 rounded-lg shadow-xl overflow-hidden z-[60]">
                    <template x-for="opt in options">
                        <button type="button" @click="select(opt.value)"
                            class="w-full text-left px-3 py-2 text-sm hover:bg-slate-700/50 text-slate-200">
                            <span x-text="opt.label"></span>
                        </button>
                    </template>
                </div>
            </div>
        </div>
        <!-- Modelo -->
        <div>
            <label class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 block">
                Modelo LLM
            </label>
            <div x-data="customSelect({ value: c.model })"
                x-effect="options = availableModels.map(m => ({value: m.id, label: m.name}))" x-modelable="value"
                x-model="c.model" class="relative z-[45]">
                <button type="button" @click="toggle()" @click.away="clickOutside()"
                    class="glass-input w-full p-2.5 rounded-lg text-sm flex justify-between items-center hover:bg-slate-800 transition-colors">
                    <span x-text="selectedLabel" class="truncate"></span>
                    <svg class="w-4 h-4 text-slate-500">
                        <use href="#icon-chevron-down"></use>
                    </svg>
                </button>
                <div x-show="open" x-transition
                    class="absolute top-full left-0 w-full mt-1 bg-[#1E293B] border border-slate-700 rounded-lg shadow-xl max-h-60 overflow-y-auto z-[60] custom-scrollbar">
                    <template x-for="opt in filteredOptions">
                        <button type="button" @click="select(opt.value)"
                            class="w-full text-left px-3 py-2 text-sm hover:bg-slate-700/50 text-slate-200">
                            <span x-text="opt.label"></span>
                        </button>
                    </template>
                </div>
            </div>
            <p class="text-xs text-slate-500 mt-1">
                ‚ÑπÔ∏è Solo se muestran modelos del proveedor seleccionado
            </p>
        </div>
    </div>

    <!-- Separador visual -->
    <div class="border-t border-slate-700/50 my-6"></div>

    <!-- SECCI√ìN 2: Estilo de Conversaci√≥n (NUEVA) -->
    <div class="space-y-4">
        <h3 class="text-sm font-bold text-blue-400 uppercase tracking-wider mb-3">
            üó£Ô∏è Estilo de Conversaci√≥n
        </h3>

        <!-- Longitud de Respuesta -->
        <div>
            <label class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 block">
                Longitud de Respuesta
            </label>
            <div x-data="customSelect({
                value: c.responseLength,
                options: [
                    {value:'very_short', label:'Muy Corta (1 frase breve)'},
                    {value:'short', label:'Corta (1-2 frases)'},
                    {value:'medium', label:'Media (2-3 frases)'},
                    {value:'long', label:'Larga (3-5 frases)'},
                    {value:'detailed', label:'Detallada (sin l√≠mite)'}
                ]
            })" x-modelable="value" x-model="c.responseLength" class="relative z-[40]">
                <button type="button" @click="toggle()" @click.away="clickOutside()"
                    class="glass-input w-full p-2.5 rounded-lg text-sm flex justify-between items-center hover:bg-slate-800 transition-colors">
                    <span x-text="selectedLabel" class="truncate"></span>
                    <svg class="w-4 h-4 text-slate-500">
                        <use href="#icon-chevron-down"></use>
                    </svg>
                </button>
                <div x-show="open" x-transition.opacity
                    class="absolute top-full left-0 w-full mt-1 bg-[#1E293B] border border-slate-700 rounded-lg shadow-xl overflow-hidden z-[60]">
                    <template x-for="opt in options">
                        <button type="button" @click="select(opt.value)"
                            class="w-full text-left px-3 py-2 text-sm hover:bg-slate-700/50 text-slate-200">
                            <span x-text="opt.label"></span>
                        </button>
                    </template>
                </div>
            </div>
            <p class="text-[10px] text-slate-500 mt-1">
                Define qu√© tan extensa ser√° cada respuesta del asistente
            </p>
        </div>

        <!-- Tono de Conversaci√≥n -->
        <div>
            <label class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 block">
                Tono de Conversaci√≥n
            </label>
            <div x-data="customSelect({
                value: c.conversationTone,
                options: [
                    {value:'professional', label:'Profesional'},
                    {value:'friendly', label:'Amigable'},
                    {value:'warm', label:'C√°lido'},
                    {value:'enthusiastic', label:'Entusiasta'},
                    {value:'neutral', label:'Neutral'},
                    {value:'empathetic', label:'Emp√°tico'}
                ]
            })" x-modelable="value" x-model="c.conversationTone" class="relative z-[35]">
                <button type="button" @click="toggle()" @click.away="clickOutside()"
                    class="glass-input w-full p-2.5 rounded-lg text-sm flex justify-between items-center hover:bg-slate-800 transition-colors">
                    <span x-text="selectedLabel" class="truncate"></span>
                    <svg class="w-4 h-4 text-slate-500">
                        <use href="#icon-chevron-down"></use>
                    </svg>
                </button>
                <div x-show="open" x-transition.opacity
                    class="absolute top-full left-0 w-full mt-1 bg-[#1E293B] border border-slate-700 rounded-lg shadow-xl overflow-hidden z-[60]">
                    <template x-for="opt in options">
                        <button type="button" @click="select(opt.value)"
                            class="w-full text-left px-3 py-2 text-sm hover:bg-slate-700/50 text-slate-200">
                            <span x-text="opt.label"></span>
                        </button>
                    </template>
                </div>
            </div>
            <p class="text-[10px] text-slate-500 mt-1">
                Controla la actitud emocional del asistente
            </p>
        </div>

        <!-- Nivel de Formalidad -->
        <div>
            <label class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 block">
                Nivel de Formalidad
            </label>
            <div x-data="customSelect({
                value: c.conversationFormality,
                options: [
                    {value:'very_formal', label:'Muy Formal'},
                    {value:'formal', label:'Formal'},
                    {value:'semi_formal', label:'Semi-Formal'},
                    {value:'casual', label:'Casual'},
                    {value:'very_casual', label:'Muy Casual'}
                ]
            })" x-modelable="value" x-model="c.conversationFormality" class="relative z-[30]">
                <button type="button" @click="toggle()" @click.away="clickOutside()"
                    class="glass-input w-full p-2.5 rounded-lg text-sm flex justify-between items-center hover:bg-slate-800 transition-colors">
                    <span x-text="selectedLabel" class="truncate"></span>
                    <svg class="w-4 h-4 text-slate-500">
                        <use href="#icon-chevron-down"></use>
                    </svg>
                </button>
                <div x-show="open" x-transition.opacity
                    class="absolute top-full left-0 w-full mt-1 bg-[#1E293B] border border-slate-700 rounded-lg shadow-xl overflow-hidden z-[60]">
                    <template x-for="opt in options">
                        <button type="button" @click="select(opt.value)"
                            class="w-full text-left px-3 py-2 text-sm hover:bg-slate-700/50 text-slate-200">
                            <span x-text="opt.label"></span>
                        </button>
                    </template>
                </div>
            </div>
            <p class="text-[10px] text-slate-500 mt-1">
                Ajusta el nivel de formalidad en el lenguaje utilizado
            </p>
        </div>

        <!-- Ritmo de Conversaci√≥n -->
        <div>
            <label class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 block">
                Velocidad de Interacci√≥n (Turn-Taking)
            </label>
            <select x-model="c.conversationPacing" class="glass-input w-full p-2.5 rounded-lg text-sm">
                <option value="fast">R√°pido (Interrupci√≥n r√°pida, respuesta inmediata)</option>
                <option value="moderate">Moderado (Pausa natural, equilibrado)</option>
                <option value="relaxed">Relajado (Espera paciente, respuesta pensada)</option>
            </select>
            <p class="text-[10px] text-slate-500 mt-1">
                Controla la din√°mica de la charla: Latencia de respuesta y tiempo de espera de
                silencio.
            </p>
        </div>
    </div>

    <!-- Separador visual -->
    <div class="border-t border-slate-700/50 my-6"></div>

    <!-- SECCI√ìN 3: Controles Avanzados LLM (NUEVOS) -->
    <div class="space-y-4">
        <h3 class="text-sm font-bold text-purple-400 uppercase tracking-wider mb-3">
            üß† Controles Avanzados de Inteligencia
        </h3>

        <!-- Context Window -->
        <div>
            <label
                class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 block flex justify-between">
                <span>Ventana de Contexto</span>
                <span class="text-blue-400" x-text="c.contextWindow"></span>
            </label>
            <input type="number" x-model="c.contextWindow" min="1" max="50"
                class="glass-input w-full p-2.5 rounded-lg text-sm">
            <p class="text-[10px] text-slate-500 mt-1">
                Cu√°ntos mensajes previos recordar√° el asistente (1-50). Mayor n√∫mero = mejor memoria pero m√°s tokens.
            </p>
        </div>

        <!-- Frequency Penalty -->
        <div>
            <label
                class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 block flex justify-between">
                <span>Penalizaci√≥n por Frecuencia</span>
                <span class="text-blue-400" x-text="c.frequencyPenalty"></span>
            </label>
            <input type="range" x-model="c.frequencyPenalty" min="0" max="2" step="0.1"
                class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500">
            <p class="text-[10px] text-slate-500 mt-1">
                Evita repetir las mismas palabras. 0 = sin penalizaci√≥n, 2 = m√°xima penalizaci√≥n.
            </p>
        </div>

        <!-- Presence Penalty -->
        <div>
            <label
                class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 block flex justify-between">
                <span>Penalizaci√≥n por Presencia</span>
                <span class="text-blue-400" x-text="c.presencePenalty"></span>
            </label>
            <input type="range" x-model="c.presencePenalty" min="0" max="2" step="0.1"
                class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500">
            <p class="text-[10px] text-slate-500 mt-1">
                Fomenta introducir nuevos temas. 0 = sin penalizaci√≥n, 2 = m√°xima diversidad.
            </p>
        </div>

        <!-- Tool Choice Strategy -->
        <div>
            <label class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 block">
                Estrategia de Herramientas (Function Calling)
            </label>
            <div x-data="customSelect({
                value: c.toolChoice,
                options: [
                    {value:'auto', label:'Autom√°tico (decide el modelo)'},
                    {value:'required', label:'Obligatorio (siempre usar)'},
                    {value:'none', label:'Desactivado (nunca usar)'}
                ]
            })" x-modelable="value" x-model="c.toolChoice" class="relative z-[25]">
                <button type="button" @click="toggle()" @click.away="clickOutside()"
                    class="glass-input w-full p-2.5 rounded-lg text-sm flex justify-between items-center hover:bg-slate-800 transition-colors">
                    <span x-text="selectedLabel" class="truncate"></span>
                    <svg class="w-4 h-4 text-slate-500">
                        <use href="#icon-chevron-down"></use>
                    </svg>
                </button>
                <div x-show="open" x-transition.opacity
                    class="absolute top-full left-0 w-full mt-1 bg-[#1E293B] border border-slate-700 rounded-lg shadow-xl overflow-hidden z-[60]">
                    <template x-for="opt in options">
                        <button type="button" @click="select(opt.value)"
                            class="w-full text-left px-3 py-2 text-sm hover:bg-slate-700/50 text-slate-200">
                            <span x-text="opt.label"></span>
                        </button>
                    </template>
                </div>
            </div>
            <p class="text-[10px] text-slate-500 mt-1">
                Controla cu√°ndo el asistente puede usar herramientas (transferir llamada, tomar cita, etc).
            </p>
        </div>

        <!-- Dynamic Variables -->
        <div>
            <label class="flex items-center space-x-2 cursor-pointer mb-2">
                <input type="checkbox" x-model="c.dynamicVarsEnabled"
                    class="w-4 h-4 rounded bg-slate-700 border-slate-600 text-blue-600">
                <span class="text-xs font-semibold text-slate-400 uppercase tracking-wider">
                    Variables Din√°micas
                </span>
            </label>
            <textarea x-show="c.dynamicVarsEnabled" x-model="c.dynamicVars" rows="3"
                class="glass-input w-full p-3 rounded-lg text-sm font-mono leading-relaxed"
                placeholder='{"nombre": "Juan P√©rez", "empresa": "Acme Corp", "producto": "Plan Premium"}'></textarea>
            <p class="text-[10px] text-slate-500 mt-1">
                Inyecta variables personalizadas en el prompt. Usa formato JSON. Ejemplo: {nombre}, {empresa}.
            </p>
        </div>
    </div>

    <!-- Separador visual -->
    <div class="border-t border-slate-700/50 my-6" x-show="false"></div>

    <div>
        <label class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 block flex justify-between">
            <span>Creatividad</span>
            <span class="text-blue-400" x-text="c.temp"></span>
        </label>
        <input type="range" x-model="c.temp" min="0" max="1" step="0.1"
            class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
        <p class="text-[10px] text-slate-500 mt-1">Nivel de aleatoriedad (0.0 = Preciso/Robot, 1.0 =
            Imaginativo/Humano).</p>
    </div>

    <div>
        <label class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 block flex justify-between">
            <span>Max Tokens</span>
            <span class="text-blue-400" x-text="c.tokens"></span>
        </label>
        <input type="number" x-model="c.tokens" class="glass-input w-full p-2.5 rounded-lg text-sm">
        <p class="text-[10px] text-slate-500 mt-1">Longitud m√°xima de la respuesta (Tokens).</p>
    </div>

    <div>
        <label class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 block">System
            Prompt</label>
        <textarea x-model="c.prompt" rows="6"
            class="glass-input w-full p-3 rounded-lg text-sm font-mono leading-relaxed"
            placeholder="Instrucciones para el agente..."></textarea>
    </div>

    <div class="grid grid-cols-1 gap-4">
        <div>
            <label class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 block">Mensaje
                Inicial</label>
            <input type="text" x-model="c.msg" class="glass-input w-full p-2.5 rounded-lg text-sm">
        </div>
        <div>
            <label class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 block">Modo Inicio</label>
            <select x-model="c.mode" class="glass-input w-full p-2.5 rounded-lg text-sm bg-slate-800">
                <option value="speak-first">Hablar Primero (Agente)</option>
                <option value="listen-first">Escuchar Primero (Usuario)</option>
            </select>
        </div>
    </div>

    <!-- Safety / Blacklist (NEW) -->
    <div class="pt-4 border-t border-slate-700/50">
        <label class="text-xs font-semibold text-red-400 uppercase tracking-wider mb-2 block flex items-center gap-2">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636">
                </path>
            </svg>
            Lista Negra (Hallucination Safety)
        </label>
        <textarea x-model="c.blacklist" rows="2"
            class="glass-input w-full p-3 rounded-lg text-xs font-mono leading-relaxed"
            placeholder="Palabras o frases prohibidas separadas por coma..."></textarea>
        <p class="text-[10px] text-slate-500 mt-1">El asistente evitar√° generar estas palabras (Stop Sequences).</p>
    </div>
</div>