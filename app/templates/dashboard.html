<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Control - Orquestador de Voz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>

<body class="bg-slate-900 text-slate-100 min-h-screen">
    <div class="container mx-auto p-4 max-w-[1600px]"> <!-- Wider container -->
        <header class="mb-6 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400">
                Orquestador de Voz Nativo
            </h1>
            <div class="px-3 py-1 bg-slate-800 rounded-full text-xs font-mono">
                Estado: <span class="text-emerald-400">● En Línea</span>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-12 gap-6 relative">
            <!-- Configuration Panel (Left, Scrollable naturally) -->
            <div class="md:col-span-5 lg:col-span-4 bg-slate-800 p-5 rounded-xl border border-slate-700 shadow-xl">
                <h2 class="text-lg font-semibold mb-3 text-blue-300">Configuración</h2>
                <script src="//unpkg.com/alpinejs" defer></script>

                <div x-data="{ 
                    tab: 'model', 
                    interruptionPhone: {{ config.interruption_threshold_phone or 2 }},
                    voiceSpeedPhone: {{ config.voice_speed_phone or 0.9 }},
                    silencePhone: {{ config.silence_timeout_ms_phone or 1200 }}
                }">
                    <!-- Tabs Header -->
                    <div class="flex space-x-1 border-b border-slate-700 mb-4 overflow-x-auto pb-1 custom-scrollbar">
                        <!-- ... unchanged tab buttons logic, just styling tweaks if needed ... -->
                        <!-- Abbreviated for diff simplicity, keeping same logic -->
                        <button @click.prevent="tab = 'model'"
                            :class="tab === 'model' ? 'border-blue-500 text-blue-400' : 'border-transparent text-slate-400 hover:text-slate-200'"
                            class="px-3 py-1.5 border-b-2 text-sm font-medium whitespace-nowrap">Modelo</button>
                        <button @click.prevent="tab = 'voice'"
                            :class="tab === 'voice' ? 'border-blue-500 text-blue-400' : 'border-transparent text-slate-400 hover:text-slate-200'"
                            class="px-3 py-1.5 border-b-2 text-sm font-medium whitespace-nowrap">Voz</button>
                        <button @click.prevent="tab = 'transcriber'"
                            :class="tab === 'transcriber' ? 'border-blue-500 text-blue-400' : 'border-transparent text-slate-400 hover:text-slate-200'"
                            class="px-3 py-1.5 border-b-2 text-sm font-medium whitespace-nowrap">Transcriptor</button>
                        <button @click.prevent="tab = 'functions'"
                            :class="tab === 'functions' ? 'border-blue-500 text-blue-400' : 'border-transparent text-slate-400 hover:text-slate-200'"
                            class="px-3 py-1.5 border-b-2 text-sm font-medium whitespace-nowrap">Funciones</button>
                        <button @click.prevent="tab = 'advanced'"
                            :class="tab === 'advanced' ? 'border-blue-500 text-blue-400' : 'border-transparent text-slate-400 hover:text-slate-200'"
                            class="px-3 py-1.5 border-b-2 text-sm font-medium whitespace-nowrap">Avanzado</button>
                        <button @click.prevent="tab = 'history'"
                            :class="tab === 'history' ? 'border-blue-500 text-blue-400' : 'border-transparent text-slate-400 hover:text-slate-200'"
                            class="px-3 py-1.5 border-b-2 text-sm font-medium whitespace-nowrap">Historial</button>
                        <button @click.prevent="tab = 'connectivity'"
                            :class="tab === 'connectivity' ? 'border-blue-500 text-blue-400' : 'border-transparent text-slate-400 hover:text-slate-200'"
                            class="px-3 py-1.5 border-b-2 text-sm font-medium whitespace-nowrap">Conexión</button>
                    </div>

                    <form action="/api/config/update" method="POST" class="space-y-4">
                        <!-- HIDDEN INPUTS AND FORM CONTENT SAME AS BEFORE (RELYING ON CONTEXT MATCH) -->
                        <input type="hidden" name="stt_provider" value="azure">
                        <input type="hidden" name="llm_provider" value="groq">
                        <input type="hidden" name="tts_provider" value="azure">


                        <!-- Tab: Model -->
                        <div x-show="tab === 'model'" class="space-y-4">
                            <!-- ... existing model content ... -->
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-1">Modelo Cerebral (Conversación)</label>
                                    <select name="llm_model"
                                        class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2">
                                        {% for m in llm_models %}
                                        <option value="{{ m }}" {% if config.llm_model==m %}selected{% endif %}>
                                            {{ m }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-1">Modelo de Extracción (Data)</label>
                                    <select name="extraction_model"
                                        class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2">
                                        {% for m in llm_models %}
                                        <option value="{{ m }}" {% if config.extraction_model==m %}selected{% endif %}>
                                            {{ m }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                    <p class="text-xs text-slate-500 mt-1">Recomendado: 8b-instant (Rápido).</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">Max Tokens</label>
                                    <input type="number" name="max_tokens" value="{{ config.max_tokens }}"
                                        class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2">
                                </div>
                            </div>

                            <div class="border border-slate-700 rounded p-3 bg-slate-800/50">
                                <label class="block text-sm font-medium mb-2">Modo del Primer Mensaje</label>
                                <select name="first_message_mode"
                                    class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2 mb-3">
                                    <option value="speak-first" {% if config.first_message_mode=='speak-first'
                                        %}selected{% endif %}>Asistente Habla Primero (Default)</option>
                                    <option value="wait-for-user" {% if config.first_message_mode=='wait-for-user'
                                        %}selected{% endif %}>Asistente Espera al Usuario</option>
                                    <option value="speak-first-dynamic" {% if
                                        config.first_message_mode=='speak-first-dynamic' %}selected{% endif %}>Asistente
                                        Habla Primero (Generado Dinámicamente)</option>
                                </select>

                                <label class="block text-sm font-medium mb-1">Contenido del Primer Mensaje</label>
                                <input type="text" name="first_message" value="{{ config.first_message }}"
                                    class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2"
                                    placeholder="Hola...">
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-1">Prompt del Sistema</label>
                                <textarea name="system_prompt" rows="6"
                                    class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2 text-sm">{{ config.system_prompt }}</textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Temperatura: <span id="temp-val">{{
                                        config.temperature }}</span></label>
                                <input type="range" name="temperature" min="0" max="1" step="0.1"
                                    value="{{ config.temperature }}" class="w-full"
                                    oninput="document.getElementById('temp-val').innerText = this.value">
                            </div>
                        </div>

                        <!-- Tab: Voice -->
                        <div x-show="tab === 'voice'" class="space-y-4" style="display: none;">
                            <!-- ... existing voice content ... -->
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-1">Voz (TTS)</label>
                                    <select name="voice_name" id="voiceSelect" onchange="updateStyles()"
                                        class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2">
                                        {% for voice in voices %}
                                        <option value="{{ voice }}" {% if config.voice_name==voice %}selected{% endif
                                            %}>{{ voice }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">Estilo / Emoción</label>
                                    <select name="voice_style" id="styleSelect"
                                        class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2">
                                        <option value="">(Estándar)</option>
                                        <!-- Populated by JS -->
                                    </select>
                                </div>
                            </div>

                            <input type="hidden" id="voice-styles-data"
                                value="{{ voice_styles | tojson | forceescape }}">
                            <script>
                                const stylesMap = JSON.parse(document.getElementById('voice-styles-data').value);
                                const currentStyle = "{{ config.voice_style or '' }}";

                                function updateStyles() {
                                    const voice = document.getElementById('voiceSelect').value;
                                    const styleSelect = document.getElementById('styleSelect');
                                    const styles = stylesMap[voice] || [];

                                    styleSelect.innerHTML = '<option value="">(Estándar)</option>';

                                    styles.forEach(s => {
                                        const opt = document.createElement('option');
                                        opt.value = s;
                                        opt.innerText = s;
                                        if (s === currentStyle && voice === "{{ config.voice_name }}") {
                                            opt.selected = true;
                                        }
                                        styleSelect.appendChild(opt);
                                    });
                                }

                                // Init
                                document.addEventListener('DOMContentLoaded', updateStyles);
                            </script>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-1">Velocidad de Voz (Navegador): <span
                                            id="speed-val">{{ config.voice_speed }}</span></label>
                                    <input type="range" name="voice_speed" min="0.5" max="2.0" step="0.05"
                                        value="{{ config.voice_speed }}" class="w-full"
                                        oninput="document.getElementById('speed-val').innerText = this.value">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">Velocidad de Voz (Teléfono): <span
                                            id="speed-val-phone" x-text="voiceSpeedPhone + 'x'"></span></label>
                                    <input type="range" name="voice_speed_phone" min="0.5" max="2.0" step="0.05"
                                        x-model="voiceSpeedPhone" class="w-full"
                                        oninput="document.getElementById('speed-val-phone').innerText = this.value + 'x'">
                                    <p class="text-xs text-slate-500 mt-1">Más lento ayuda en telefonía (0.9
                                        recomendado).</p>
                                </div>
                            </div>

                            <div class="border-t border-slate-700 my-4 pt-4">

                                <div>
                                    <label class="block text-sm font-medium mb-1">ID de Voz Manual
                                        (Sobrescribir)</label>
                                    <input type="text" name="voice_id_manual" value="{{ config.voice_id_manual or '' }}"
                                        class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2"
                                        placeholder="ej. en-US-DavisNeural">
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Sonido de Fondo</label>
                                        <select name="background_sound"
                                            class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2">
                                            <option value="none" {% if config.background_sound=='none' %}selected{%
                                                endif %}>Ninguno
                                            </option>
                                            <option value="office" {% if config.background_sound=='office' %}selected{%
                                                endif %}>Oficina
                                            </option>
                                            <option value="cafe" {% if config.background_sound=='cafe' %}selected{%
                                                endif %}>Cafetería
                                            </option>
                                            <option value="call_center" {% if config.background_sound=='call_center'
                                                %}selected{% endif %}>Call Center</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Mínimo Caracteres Entrada</label>
                                        <input type="number" name="input_min_characters"
                                            value="{{ config.input_min_characters }}"
                                            class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2">
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-1">URL Sonido de Fondo
                                        (Externo)</label>
                                    <input type="text" name="background_sound_url"
                                        value="{{ config.background_sound_url or '' }}"
                                        class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2"
                                        placeholder="https://example.com/ambiente.mp3">
                                </div>
                            </div>
                        </div>

                        <!-- Tab: Transcriber (Updated with Segmentation) -->
                        <div x-show="tab === 'transcriber'" class="space-y-4" style="display: none;">
                            <div>
                                <label class="block text-sm font-medium mb-1">Idioma de Transcripción</label>
                                <select name="stt_language"
                                    class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2">
                                    {% for lang in languages %}
                                    <option value="{{ lang }}" {% if config.stt_language==lang %}selected{% endif %}>{{
                                        lang }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Tiempo de Silencio (General)
                                            (ms)</label>
                                        <input type="number" name="silence_timeout_ms"
                                            value="{{ config.silence_timeout_ms }}"
                                            class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-1">
                                        <p class="text-xs text-slate-500 mt-1">Espera X ms de silencio para saber que
                                            terminaste de hablar.</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Tiempo de Silencio Inicial
                                            (ms)</label>
                                        <input type="number" name="initial_silence_timeout_ms"
                                            value="{{ config.initial_silence_timeout_ms or 5000 }}"
                                            class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-1">
                                        <p class="text-xs text-slate-500 mt-1">Si nadie habla al inicio por X ms, se
                                            cancela/reinicia el reconocimiento.</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Tiempo Máx. Segmentación
                                            (ms)</label>
                                        <input type="number" name="segmentation_max_time"
                                            value="{{ config.segmentation_max_time }}"
                                            class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-1">
                                        <p class="text-xs text-slate-500 mt-1">Corta el audio a los X ms si hay ruido
                                            continuo.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Moved from Connectivity -->
                        <!-- Configuración Avanzada de Audio y Telefonía -->
                        <div class="space-y-4 pt-4 border-t border-slate-700 mt-4">
                            <h4 class="text-sm font-medium text-slate-300">Configuración Avanzada de Audio</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-1">Estrategia de Segmentación</label>
                                    <select name="segmentation_strategy"
                                        class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2">
                                        <option value="default" {% if config.segmentation_strategy=='default'
                                            %}selected{% endif %}>Default</option>
                                        <option value="time" {% if config.segmentation_strategy=='time' %}selected{%
                                            endif %}>Tiempo</option>
                                        <option value="semantic" {% if config.segmentation_strategy=='semantic'
                                            %}selected{% endif %}>Semántica</option>
                                    </select>
                                </div>
                                <div class="flex items-center pt-6">
                                    <input type="hidden" name="enable_denoising" value="false">
                                    <input type="checkbox" name="enable_denoising" value="true"
                                        class="w-5 h-5 rounded border-slate-600 bg-slate-800 text-blue-600" {% if
                                        config.enable_denoising %}checked{% endif %}>
                                    <label class="text-sm font-medium ml-2">Habilitar Reducción de Ruido</label>
                                </div>
                            </div>

                            <h4 class="text-sm font-medium text-slate-300 pt-4 border-t border-slate-700">Sensibilidad y
                                Control de Interrupciones</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-1 flex justify-between">
                                        <span>Sensibilidad Interrupción (Navegador)</span>
                                        <span class="text-xs text-slate-400">{{ config.interruption_threshold }}
                                            chars</span>
                                    </label>
                                    <input type="range" name="interruption_threshold" min="0" max="30" step="1"
                                        value="{{ config.interruption_threshold }}"
                                        class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer"
                                        oninput="this.previousElementSibling.lastElementChild.innerText = this.value + ' chars'">
                                    <p class="text-xs text-slate-500 mt-1">Ignora ruidos menores a X caracteres.</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1 flex justify-between">
                                        <span>Sensibilidad Interrupción (Teléfono)</span>
                                        <span class="text-xs text-slate-400"
                                            x-text="interruptionPhone + ' chars'"></span>
                                    </label>
                                    <input type="range" name="interruption_threshold_phone" min="0" max="20" step="1"
                                        x-model="interruptionPhone"
                                        class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                                    <p class="text-xs text-slate-500 mt-1">Más bajo = Más sensible (2-4 rec).</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mt-2">
                                <div>
                                    <label class="block text-sm font-medium mb-1 flex justify-between">
                                        <span>Tiempo de Silencio (Teléfono)</span>
                                        <span class="text-xs text-slate-400" x-text="silencePhone + ' ms'"></span>
                                    </label>
                                    <input type="range" name="silence_timeout_ms_phone" min="500" max="3000" step="100"
                                        x-model="silencePhone"
                                        class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                                    <p class="text-xs text-slate-500 mt-1">Silencio para fin de turno en teléfono.</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">Límites de Puntuación</label>
                                    <input type="text" name="punctuation_boundaries"
                                        value="{{ config.punctuation_boundaries or '' }}"
                                        class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-1"
                                        placeholder="Ej: . ? !">
                                    <p class="text-xs text-slate-500 mt-1">Opcional. Segmentar por puntuación.</p>
                                </div>
                            </div>
                        </div>
                </div>


                <!-- Tab: Connectivity -->
                <div x-show="tab === 'connectivity'" class="space-y-4" style="display: none;">
                    {% include 'partials/connectivity.html' %}
                </div>

                <!-- Tab: Functions -->
                <div x-show="tab === 'functions'" class="space-y-4" style="display: none;">
                    <h3 class="text-sm font-semibold text-blue-300">Funciones Predefinidas</h3>

                    <div class="flex items-center justify-between bg-slate-800 p-3 rounded border border-slate-700">
                        <div>
                            <h4 class="font-medium">Habilitar Función "Colgar"</h4>
                            <p class="text-xs text-slate-400">Permite al asistente terminar la llamada.</p>
                        </div>
                        <div class="flex items-center">
                            <input type="hidden" name="enable_end_call" value="false">
                            <input type="checkbox" name="enable_end_call" value="true"
                                class="w-6 h-6 rounded bg-slate-700 border-slate-600 text-green-500" {% if
                                config.enable_end_call %}checked{% endif %}>
                        </div>
                    </div>

                    <div class="flex items-center justify-between bg-slate-800 p-3 rounded border border-slate-700">
                        <div>
                            <h4 class="font-medium">Habilitar Teclado Numérico</h4>
                            <p class="text-xs text-slate-400">Permite marcar extensiones o números.</p>
                        </div>
                        <div class="flex items-center">
                            <input type="hidden" name="enable_dial_keypad" value="false">
                            <input type="checkbox" name="enable_dial_keypad" value="true"
                                class="w-6 h-6 rounded bg-slate-700 border-slate-600 text-green-500" {% if
                                config.enable_dial_keypad %}checked{% endif %}>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-1">Número para Transferencia</label>
                        <input type="text" name="transfer_phone_number" value="{{ config.transfer_phone_number or '' }}"
                            class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2" placeholder="+52...">
                    </div>
                </div>

                <!-- Tab: Advanced -->
                <div x-show="tab === 'advanced'" class="space-y-4" style="display: none;">
                    <h3 class="text-sm font-semibold text-blue-300">Control de Flujo (Heredado)</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Tiempo Espera Inactividad (s)</label>
                            <input type="number" name="idle_timeout" step="0.5" value="{{ config.idle_timeout }}"
                                class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-1">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Duración Máx (s)</label>
                            <input type="number" name="max_duration" value="{{ config.max_duration }}"
                                class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-1">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Mensaje de Inactividad</label>
                        <input type="text" name="idle_message" value="{{ config.idle_message }}"
                            class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Mensaje de Inactividad</label>
                        <input type="text" name="idle_message" value="{{ config.idle_message }}"
                            class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-1">
                    </div>
                </div>

                <!-- Tab: History -->
                <div x-show="tab === 'history'" class="space-y-4" style="display: none;">
                    <h3 class="text-lg font-medium text-slate-200">Llamadas Recientes</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-slate-400">
                            <thead class="text-xs text-slate-200 uppercase bg-slate-700">
                                <tr>
                                    <th class="px-4 py-2">ID</th>
                                    <th class="px-4 py-2">Fecha</th>
                                    <th class="px-4 py-2">Estado</th>
                                    <th class="px-4 py-2">Acción</th>
                                </tr>
                            </thead>

                            <tbody hx-get="/dashboard/history-rows" hx-trigger="load, refreshHistory from:body"
                                hx-target="this">
                                <!-- Initial load will be handled by HTMX or server-side render fallthrough if needed, 
                                            but to avoid duplication we'll let HTMX load it or keep static for SEO/Non-JS. 
                                            Actually, let's keep the server-side render for first paint, and HTMX for updates. -->
                                {% include "partials/history_rows.html" %}
                            </tbody>
                        </table>
                    </div>
                </div>



                <div class="pt-4 border-t border-slate-700">
                    <button type="submit"
                        class="w-full bg-blue-600 hover:bg-blue-500 py-3 rounded font-medium transition-colors shadow-lg">
                        Guardar Configuración Completa
                    </button>
                </div>
                </form>
            </div>
        </div>

        <!-- Simulator Panel (Sticky, Right Side) -->
        <div class="md:col-span-7 lg:col-span-8 sticky top-6 self-start space-y-4">
            <div class="bg-slate-800 p-5 rounded-xl border border-slate-700 shadow-xl flex flex-col min-h-[500px]">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-emerald-300">Simulador de Llamada</h2>
                    <button id="start-btn" onclick="toggleCall()"
                        class="px-6 py-2 bg-emerald-600 hover:bg-emerald-500 rounded font-bold shadow-lg transition-all">
                        Iniciar Prueba
                    </button>
                </div>

                <div
                    class="flex-grow bg-slate-900 rounded-lg p-4 border border-slate-600 relative overflow-hidden flex flex-col items-center justify-center min-h-[300px]">
                    <div id="status-indicator" class="text-slate-500 font-mono mb-4 text-lg">Listo para conectar...
                    </div>

                    <!-- Visualizer Canvas -->
                    <canvas id="visualizer" width="600" height="100" class="w-full h-32"></canvas>
                </div>

                <!-- Latest Transcript -->
                <div class="mt-4 p-4 bg-slate-900/50 rounded border border-slate-700">
                    <h3 class="text-sm font-mono text-slate-400 mb-2">TRANSCRIPCIÓN EN VIVO</h3>

                    <div id="transcript-box" class="h-40 overflow-y-auto text-sm space-y-2">
                        <!-- Messages inserted by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <script src="/static/js/simulator.js"></script>
</body>

</html>